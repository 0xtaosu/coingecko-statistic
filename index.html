<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coin Statistics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        th {
            cursor: pointer;
        }

        .score-detail {
            font-size: 0.8em;
            color: #666;
        }

        .rank {
            color: #999;
            font-size: 0.9em;
        }

        .total-score {
            font-weight: bold;
        }

        tr:hover {
            background-color: #f8f9fa;
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <h1 class="mb-4">Coin Statistics</h1>
        <table class="table table-hover">
            <thead>
                <tr>
                    <th onclick="sortTable(0)">Rank</th>
                    <th onclick="sortTable(1)">Symbol</th>
                    <th onclick="sortTable(2)">Name</th>
                    <th onclick="sortTable(3)" class="text-end">Total Score</th>
                    <th>Score Details</th>
                </tr>
            </thead>
            <tbody id="coinTableBody">
            </tbody>
        </table>
        <div class="mt-4">
            <h4>Calculation Method:</h4>
            <p>The total score is calculated based on the following factors:</p>
            <ul>
                <li>Consolidation Score (权重 1.5): 评估横盘特征</li>
                <li>Volume Stability Score (权重 1.0): 评估成交量稳定性</li>
                <li>Breakout Score (权重 1.5): 评估价格突破情况</li>
                <li>Breakout Volume Score (权重 1.0): 评估突破时的成交量表现</li>
                <li>RSI Score (权重 1.0): 评估相对强弱指标</li>
                <li>MA Score (权重 1.0): 评估均线位置关系</li>
                <li>Market Cap Score (权重 1.0): 评估市值规模</li>
            </ul>
        </div>
    </div>

    <script>
        fetch('coin_scores.csv')
            .then(response => response.text())
            .then(data => {
                const rows = data.split('\n').slice(1);  // 跳过标题行
                const coinData = rows.map(row => {
                    const columns = row.split(',');
                    if (columns.length < 22) return null;
                    return {
                        rank: columns[3],
                        symbol: columns[1],
                        name: columns[2],
                        consolidation_volatility: columns[11],  // 使用原始数据
                        consolidation_range: columns[12],
                        volume_stability: columns[13],
                        breakout_price_change: columns[14],
                        breakout_volume_change: columns[15],
                        rsi_current: columns[16],
                        rsi_trend: columns[17],
                        ma_trend: columns[18],
                        market_cap: columns[19],
                        total_score: columns[21]
                    };
                }).filter(coin => coin !== null);

                // 按总分排序
                coinData.sort((a, b) => Number(b.total_score) - Number(a.total_score));

                const tableBody = document.getElementById('coinTableBody');
                coinData.forEach(coin => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="rank">#${coin.rank}</td>
                        <td>${coin.symbol.toUpperCase()}</td>
                        <td>${coin.name}</td>
                        <td class="text-end total-score">${coin.total_score}</td>
                        <td class="score-detail">
                            横盘: ${coin.consolidation_volatility} |
                            成交量: ${coin.volume_stability} |
                            突破: ${coin.breakout_price_change} |
                            突破量: ${coin.breakout_volume_change} |
                            RSI: ${coin.rsi_current} |
                            MA: ${coin.ma_trend} |
                            市值: ${coin.market_cap}
                        </td>
                    `;
                    tableBody.appendChild(tr);
                });
            });

        function sortTable(n) {
            const table = document.querySelector("table");
            const tbody = table.querySelector("tbody");
            const rows = Array.from(tbody.querySelectorAll("tr"));

            const direction = table.getAttribute("data-sort-direction") === "asc" ? -1 : 1;
            table.setAttribute("data-sort-direction", direction === 1 ? "asc" : "desc");

            const sortedRows = rows.sort((row1, row2) => {
                const cell1 = row1.querySelectorAll("td")[n];
                const cell2 = row2.querySelectorAll("td")[n];
                const val1 = n === 3 ? Number(cell1.textContent) : cell1.textContent;
                const val2 = n === 3 ? Number(cell2.textContent) : cell2.textContent;

                if (typeof val1 === "number") {
                    return direction * (val2 - val1);
                } else {
                    return direction * val1.localeCompare(val2);
                }
            });

            tbody.innerHTML = "";
            sortedRows.forEach(row => tbody.appendChild(row));
        }
    </script>
</body>

</html>