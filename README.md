# CoinGecko 统计与 Telegram Bot

本项目从 CoinGecko API 获取并分析顶级加密货币，为每个币种计算得分，并将结果保存到 CSV 文件中。此外，它还包含一个 Telegram Bot，每天自动发送前 50 个得分最低的币种信息，并提供一个简单的 HTTP 服务器来展示结果。

## 功能特点

- 从 CoinGecko API 获取顶级币种，支持自定义批次
- 将原始数据保存到 CSV 文件中
- 基于多个因素为每个币种计算得分
- 将分析结果保存到单独的 CSV 文件中
- 命令行界面，支持灵活的批次处理和独立的数据获取与分析操作
- Telegram Bot 自动每天发送前 50 个得分最低的币种信息
- 简单的 HTTP 服务器，用于展示分析结果


## 计算方法

币种得分基于以下七个因素，总分为这些因素的加权总和：

1. 横盘特征评分 (Consolidation Score) - 权重 1.5
   - 使用前90天数据评估横盘特征
   - 计算价格波动范围和稳定性
   - 得分 = max(0, min(10, 10 - consolidation_range * 100))
   - 横盘越稳定，得分越高

2. 成交量稳定性评分 (Volume Stability Score) - 权重 1.0
   - 评估横盘期间的成交量稳定性
   - 使用成交量标准差与均值的比率
   - 得分 = max(0, min(10, 10 - volume_stability * 10))
   - 成交量越稳定，得分越高

3. 突破评分 (Breakout Score) - 权重 1.5
   - 评估最近14天的价格突破情况
   - 对比横盘期间的平均价格
   - 得分 = max(0, min(10, int(breakout_price_change)))
   - 突破幅度越大，得分越高

4. 突破成交量评分 (Breakout Volume Score) - 权重 1.0
   - 评估突破期间的成交量放大情况
   - 对比横盘期间的平均成交量
   - 得分 = max(0, min(10, int(breakout_volume_change * 0.5)))
   - 成交量放大越明显，得分越高

5. RSI评分 (RSI Score) - 权重 1.0
   - 关注RSI从低位回升的趋势
   - 计算最近RSI低点到当前的变化
   - 得分 = max(0, min(10, int(rsi_trend * 0.5)))
   - RSI回升幅度越大，得分越高

6. 移动平均线评分 (MA Score) - 权重 1.0
   - 评估价格对MA20和MA60的突破情况
   - 同时考虑均线趋势
   - 得分 = max(0, min(10, int(5 + ma_trend))) 如果突破均线，否则为0
   - 突破均线且趋势向上时得分较高

7. 市值评分 (Market Cap Score) - 权重 1.0
   - 倾向于选择中小市值代币
   - 得分 = min(10, max(0, int(15 - log10(market_cap))))
   - 市值越小，得分越高（在合理范围内）

总分计算：
- 总分 = 各项得分 * 对应权重的总和
- 横盘和突破特征具有更高权重（1.5）
- 其他指标权重为1.0
- 所有指标都经过数据验证，确保在出现异常值时返回合理结果

筛选标准：
- 要求至少有30天的历史数据
- 优先选择：
  1. 有明显的横盘积累阶段
  2. 最近开始突破的币种
  3. 突破时成交量明显放大
  4. RSI从低位回升
  5. 突破主要均线
  6. 市值适中的代币

注意事项：
- 所有数据都会经过清理，去除无效值
- 如果数据量不足90天，会动态调整计算窗口
- 得分仅反映技术面表现，不应作为唯一的投资决策依据
- 建议结合基本面分析和其他因素进行综合判断

## 回测系统

回测系统基于历史数据模拟交易策略的表现，主要包含以下核心策略：

### 1. 交易信号生成

#### 1.1 底部横盘突破策略（主要策略）
- **横盘特征**：
  * 价格在±5%区间内横盘至少60天
  * 日均交易量保持稳定
  * 波动率逐渐收窄
- **突破确认**：
  * 价格突破横盘区间上沿
  * 突破时成交量显著放大（至少2倍于平均水平）

#### 1.2 RSI超卖回升确认
- RSI跌至30以下（超卖区域）
- 开始回升并突破40
- 回升速度要适中，避免过度陡峭

#### 1.3 移动平均线趋势验证
- 20日和60日均线逐渐趋于平缓
- 价格突破双均线
- 20日均线上穿60日均线

#### 1.4 市值和流动性筛选
- 市值范围：1亿-50亿美元
- 最小日均交易量：100万美元
- 避免市值过小或过大的币种

### 2. 风险管理

#### 2.1 资金管理（基于10000美元初始资金）
- 单个仓位最大限额：1000美元（10%）
- 最小交易金额：100美元
- 最大同时持仓数：5个币种
- 总仓位上限：50%资金

#### 2.2 止盈止损
- 止损位：-10%
- 止盈位：+20%
- 技术面失效时提前退出

### 3. 交易执行

#### 3.1 入场条件
- 综合得分超过7分（满分10分）
- 各指标权重：
  * 横盘突破：1.5
  * 成交量稳定性：1.0
  * 突破确认：1.5
  * 成交量突破：1.0
  * RSI指标：1.0
  * 均线指标：1.0
  * 市值评分：1.0

#### 3.2 退出策略
1. **止盈退出**：
   - 达到20%利润目标
   - 可选择分批获利
2. **止损退出**：
   - 价格跌破10%止损线
   - 突破形态失效
3. **技术面退出**：
   - RSI超买（>70）
   - 成交量明显萎缩
   - 均线走平或下转

### 4. 回测评估指标

- 总收益率
- 最大回撤
- 胜率
- 平均盈亏比
- 夏普比率
- 交易次数

### 5. 策略优势

1. **风险可控**：
   - 明确的入场点
   - 固定的止损位
   - 合理的仓位控制

2. **多重确认**：
   - 技术指标交叉验证
   - 成交量配合验证
   - 趋势跟随特性

3. **客观执行**：
   - 明确的进出场条件
   - 固定的风控规则
   - 适合自动化操作

### 6. 注意事项

- 回测结果仅供参考，不构成投资建议
- 实际交易中需考虑滑点和手续费
- 建议在实盘前进行充分的模拟测试
- 定期评估和优化策略参数
- 结合市场环境调整交易策略

### 7. 使用方法

运行回测系统：
```bash
python backtest.py
```

回测结果将生成：
- 收益曲线图表（portfolio_performance.png）
- 详细的交易记录
- 策略表现统计数据

## 系统要求

- Python 3.7+

## 安装

1. 克隆此仓库：
   ```
   git clone https://github.com/0xtaosu/coingecko-statistic.git
   cd coingecko-statistic
   ```

2. 安装所需包：
   ```
   pip install -r requirements.txt
   ```

3. 配置环境变量：
   在项目根目录创建一个 `.env` 文件，并添加以下内容：
   ```
   COINGECKO_API_KEY=你的CoinGecko API密钥
   TELEGRAM_BOT_TOKEN=你的Telegram Bot Token
   TELEGRAM_CHAT_ID=你的Telegram聊天ID
   ```
   请确保将 `.env` 文件添加到 `.gitignore` 中，以避免将敏感信息提交到版本控制系统。

## 使用方法

### 运行整个系统

使用以下命令启动整个系统，包括数据处理、Telegram Bot 和 HTTP 服务器：
```
python main.py
```

这将启动以下组件：
- HTTP 服务器（在 http://localhost:8000 上运行）
- 每日数据处理任务（每天早上 9:00 运行）
- Telegram Bot（每天早上 9:30 发送更新）

### 单独运行数据处理

如果你想单独运行数据处理，可以使用以下命令：

```
python data_processor.py <批次1> <批次2> ... [--fetch] [--analyze]
```
每个批次应该采用 `起始-结束` 的格式。例如：

```
python data_processor.py 1-50 51-100 101-150 151-200 201-250 251-300 --fetch --analyze
```

这将处理排名 1-50、51-100、101-150、151-200、201-250、251-300 的币种，获取数据并进行分析。

选项说明：
- `--fetch`: 从 CoinGecko API 获取新数据并保存到 data.csv
- `--analyze`: 分析 data.csv 中的数据并生成 coin_scores.csv

### 运行回测系统
```
python backtest.py
```

### 单独运行 Telegram Bot

如果你只想运行 Telegram Bot，可以使用以下命令：

```
python tg_bot.py
```


## 代码结构

- `main.py`: 主脚本，用于启动整个系统
- `data_processor.py`: 数据获取和分析的脚本
- `backtest.py`: 回测系统脚本
- `tg_bot.py`: Telegram Bot 脚本
- `requirements.txt`: 项目依赖列表

## 生成文件说明
- `data.csv`: CoinGecko的180天的数据，价格，交易量和市值
- `coin_scores.csv`: 每个币种的得分
- `portfolio_performance.png`: 回测系统的收益曲线图表
- `trades_log.csv`: 回测系统的交易记录
- `backtest_log.csv`: 回测系统的策略表现统计数据

## 注意事项

- 确保您有稳定的互联网连接以从 CoinGecko API 获取数据。
- 处理大批量数据或频繁运行脚本时，请注意 API 速率限制。
- 得分计算使用最近 180 天的数据，这可能会影响新上市或数据不足的币种的得分。
- 得分仅反映特定的技术指标，不应作为唯一的投资决策依据。
- 运行 `main.py` 后，系统将持续运行直到手动停止（使用 Ctrl+C）。

## 贡献

欢迎贡献、提出问题和功能请求。如果您想贡献，请查看 [问题页面](https://github.com/你的用户名/coingecko-statistic/issues)。

## 许可证

[MIT](https://choosealicense.com/licenses/mit/)
